{% extends "base.html" %}
{% block content %}
<div class="grid grid-cols-1 gap-6 lg:grid-cols-12">
  <div class="lg:col-span-8 space-y-6">
    <div class="rounded-2xl border border-black bg-white p-6 shadow-sm">
      <div class="flex flex-col justify-between gap-4 sm:flex-row sm:items-center">
        <div>
          <h1 class="text-2xl font-bold tracking-tight">Dashboard</h1>
          <p class="mt-1 text-slate-600">Welcome back. Manage your communities and conversations.</p>
        </div>
        <div class="flex gap-2">
          <a href="{{ url_for('chat.create_community') }}" class="rounded-full bg-slate-900 text-white px-4 py-2 text-sm font-semibold hover:bg-slate-800 transition">Create Community</a>
        </div>
      </div>
      <!-- Sample content cards -->
      <div class="mt-6 grid gap-4 sm:grid-cols-2">
        <div class="rounded-xl border border-black p-4 bg-slate-50">
          <h3 class="text-sm font-semibold">Active Communities</h3>
          <p class="mt-2 text-3xl font-bold">4</p>
          <p class="mt-1 text-xs text-slate-500">See overview of groups</p>
        </div>
        <div class="rounded-xl border border-black p-4 bg-white">
          <h3 class="text-sm font-semibold">Trending</h3>
          <p class="mt-2 text-2xl font-bold text-blue-300">Design, Development, Photography</p>
        </div>
      </div>
    </div>

    <div class="rounded-2xl border border-black bg-white p-6 shadow-sm">
      <h3 class="text-lg font-medium">Joined Communities</h3>
      <ul class="mt-4 space-y-3">
        {% if joined_communities %}
          {% for community in joined_communities %}
          <li class="flex items-start justify-between gap-3">
            <div class="flex-1">
              <div class="text-sm font-medium">{{ community.name }}</div>
              <div class="text-xs text-slate-500">{{ community.description or "No description" }}</div>
            </div>
            <div class="text-xs text-slate-400 flex items-center gap-3">
              <a href="{{ url_for('chat.community', cid=community.id) }}" class="text-blue-600 underline">Open Chat</a>
              <form method="POST" action="{{ url_for('chat.leave_community', cid=community.id) }}" class="inline">
                  {{ form.hidden_tag() }}
                  <button type="submit" class="flex-shrink-0 w-8 h-8 flex items-center justify-center bg-gray-100 text-gray-600 rounded-full hover:bg-gray-200 transition-colors" title="Leave Community" onclick="return confirm('Are you sure you want to leave this community?');">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                          <path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V5.414l7.293 7.293a1 1 0 001.414-1.414L5.414 4H15a1 1 0 100-2H4a1 1 0 00-1 1z" clip-rule="evenodd" />
                      </svg>
                  </button>
              </form>
            </div>
          </li>
          {% endfor %}
        {% else %}
          <li class="text-xs text-slate-500">You haven't joined any communities yet. <a href="{{ url_for('chat.communities') }}" class="underline">Browse communities</a> to get started.</li>
        {% endif %}
      </ul>
    </div>

    <div class="rounded-2xl border border-black bg-white p-6 shadow-sm">
      <h3 class="text-lg font-medium">Hosted Communities</h3>
      <ul class="mt-4 space-y-3">
        {% if hosted_communities %}
          {% for community in hosted_communities %}
          <li class="flex items-start gap-3">
            <div class="flex-1">
              <div class="text-sm font-medium">{{ community.name }}</div>
              <div class="text-xs text-slate-500">{{ community.description or "No description" }}</div>
              {% if community.visibility == 'private' and community.join_code %}
                <div class="text-xs text-yellow-700 mt-1">
                  Join Code: <span class="font-mono font-medium select-all">{{ community.join_code }}</span>
                </div>
              {% endif %}
            </div>
            <div class="text-xs text-slate-400 flex items-center gap-3">
              <a href="{{ url_for('chat.community', cid=community.id) }}" class="text-blue-600 underline">Open Chat</a>
              <form method="POST" action="{{ url_for('chat.delete_community', cid=community.id) }}" class="inline">
                  {{ form.hidden_tag() }}
                  <button type="submit" class="flex-shrink-0 w-8 h-8 flex items-center justify-center bg-red-100 text-red-600 rounded-full hover:bg-red-200 transition-colors" title="Delete Community" onclick="return confirm('Are you sure you want to permanently delete this community? This cannot be undone.');">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                          <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                      </svg>
                  </button>
              </form>
            </div>
          </li>
          {% endfor %}
        {% else %}
          <li class="text-xs text-slate-500">You haven't hosted any communities yet.</li>
        {% endif %}
      </ul>
    </div>
  </div>

  <aside class="lg:col-span-4 space-y-6">
    <div class="rounded-2xl border border-black bg-white p-6 shadow-sm">
      <h3 class="mb-3 text-sm font-semibold text-slate-700">Quick Actions</h3>
      <div class="flex flex-wrap gap-2">
        <a href="{{ url_for('chat.communities') }}" class="rounded-full border px-3 py-1 text-sm font-medium shadow-sm hover:bg-slate-50">Browse Communities</a>
      </div>
    </div>

    <div class="rounded-2xl border border-black bg-slate-50 p-6 shadow-sm"><center>
      <!-- From Uiverse.io by andrew-demchenk0 --> 
      <div class="card">
        <div class="card__img">
        <img src="{{ url_for('static', filename='chat/bg.jpg') }}" 
         alt="Card Background" 
         width="540" 
         height="450">
        </div>
        <div class="card__avatar">
          <img src="{{ url_for('static', filename='chat/avatr.png') }}" width="128" height="128" alt="User Avatar">
        </div>
        <div class="card__title">{{ user.username or user.email if user else 'User' }}</div>
        <div class="card__subtitle">open to chat</div>
        <div class="card__wrapper">
        <!-- <button class="card__btn">Button</button>
        <button class="card__btn card__btn-solid">Button</button> -->
        </div>
      </div></center></div>
  </aside>
  
</div>
<style>
/* From Uiverse.io by andrew-demchenk0 */ 
.card {
  --main-color: #000;
  --submain-color: #2f3438;
  --bg-color: #fff;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
  position: relative;
  width: 300px;
  height: 384px;
  display: flex;
  flex-direction: column;
  align-items: center;
  border-radius: 20px;
  background: var(--bg-color);
}

.card__img {
  height: 192px;
  width: 100%;
}

.card__img svg {
  height: 100%;
  border-radius: 20px 20px 0 0;
}

.card__avatar {
  position: absolute;
  width: 114px;
  height: 114px;
  background: var(--bg-color);
  border-radius: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  top: calc(50% - 57px);
}

.card__avatar svg {
  width: 100px;
  height: 100px;
}

.card__title {
  margin-top: 60px;
  font-weight: 500;
  font-size: 18px;
  color: var(--main-color);
}

.card__subtitle {
  margin-top: 10px;
  font-weight: 400;
  font-size: 15px;
  color: var(--submain-color);
}

.card__btn {
  margin-top: 15px;
  width: 76px;
  height: 31px;
  border: 2px solid var(--main-color);
  border-radius: 4px;
  font-weight: 700;
  font-size: 11px;
  color: var(--main-color);
  background: var(--bg-color);
  text-transform: uppercase;
  transition: all 0.3s;
}

.card__btn-solid {
  background: var(--main-color);
  color: var(--bg-color);
}

.card__btn:hover {
  background: var(--main-color);
  color: var(--bg-color);
}

.card__btn-solid:hover {
  background: var(--bg-color);
  color: var(--main-color);
}
</style>
{% endblock %}
